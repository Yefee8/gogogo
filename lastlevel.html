<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body style="background: black;">

<script>
    let isDied = false;
    let config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: {y: 200}
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    let game = new Phaser.Game(config);

    function preload() {
        this.load.setBaseURL('https://yefee8.github.io/runrunrun');
        this.load.image('dude', '/char.svg');
        this.load.image('ground', '/platform.svg');
        this.load.image('deadplatform', '/deadplatform.svg');
        this.load.image('winthing', '/endplatform.svg');
        this.load.image('particle', '/particle.svg');
        this.load.image('goneplatform', '/gonePlatform.svg')
    }

    let platforms;


    function create() {
        if (localStorage.getItem('alerted2')) {
        } else {
            alert('speed changed')
            localStorage.setItem('alerted2', 'alerted.')
        }

        function die() {
            location.reload()
        }


        function win() {
            alert('Congratulations, you finished the game by wasting 15 minutes of your time.')
        }


        // badthings
        badthings = this.physics.add.staticGroup();

        // End Platforms
        endplatforms = this.physics.add.staticGroup();

        // Platform things
        platforms = this.physics.add.staticGroup();

        // main platform
        platforms.create(0, window.innerHeight, 'ground').setScale(10000, 1)


        // Platforms
        badthings.create(window.innerWidth/2+200, 100, 'deadplatform')
        badthings.create(window.innerWidth/2, 200, 'deadplatform')
        badthings.create(window.innerWidth/2, 200, 'deadplatform')
        badthings.create(window.innerWidth/2-400, 300, 'deadplatform')
        badthings.create(window.innerWidth/2-400, 300, 'deadplatform')
        badthings.create(window.innerWidth/2-800, 600, 'deadplatform')
        badthings.create(window.innerWidth/2-600, 800, 'deadplatform')
        endplatforms.create(window.innerWidth/2, 900, 'winthing')

        // Particle things
        let particles = this.add.particles('particle');
        let emitter = particles.createEmitter({
            speed: 100,
            scale: {start: 0.5, end: 0},
            blendMode: 'ADD'
        });
        emitter.setPosition(window.innerWidth/2, 900);

        // Player things
        player = this.physics.add.sprite(100, 100, 'dude');
        player.setPosition(window.innerWidth/2 - 100, 0);
        player.setScale(0.5)
        player.setBounce(0);
        player.setCollideWorldBounds(true);
        player.body.setGravityY(100)

        // Physics add
        this.physics.add.collider(player, platforms);
        this.physics.add.overlap(player, endplatforms, win, null, this)
        this.physics.add.overlap(player, badthings, die, null, this);

    }

    let isJumped = false

    function update() {
        if (!isDied) {
            let cursors = this.input.keyboard.createCursorKeys();
            if (cursors.left.isDown) {
                player.setVelocityX(-520);

            } else if (cursors.right.isDown) {
                player.setVelocityX(520);
            } else {
                player.setVelocityX(0);
            }

            if (cursors.up.isDown && player.body.touching.down) {
                let i = 0;
                player.setVelocityY(-330);

                if (!isJumped) {
                    let a = setInterval(() => {
                        i++;
                        if (i === 180) {
                            player.angle = 0;
                            clearInterval(a);
                        }
                        player.angle = i;
                    }, 5)
                }

                isJumped = true
                setTimeout(() => {
                    isJumped = false;
                }, 900)
            }
        } else {
            return;
        }
    }


</script>
</body>
</html>

